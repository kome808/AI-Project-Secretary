# 模組：任務清單（Tasks）

## 目標
作為唯一工作入口：所有入庫項目以視圖（Tabs/Filters）呈現，不拆成多入口模組。

## 視圖（Tabs）
- 我的任務（預設：一般成員）
- 專案工作（預設：PM）
- 待回覆（Pending）
- 變更（CR）
- 決議（Decisions）
- （可選）執行地圖（Map）

## 預設頁規則
- 一般成員：預設「我的任務」
- PM：預設「專案工作」
- 若使用者在該專案切換過視圖：記住上次視圖（優先於預設）

## 共用 UI 規則
- 列表/卡片都要顯示：
  - 標題、狀態、負責人、期限（若有）、Citation（可點）
  - **備註（若有）**：在卡片底部顯示預覽（最多 2 行）
- 支援 @標記與指派（由 UI 操作完成）
- 主要操作保持極簡：狀態切換、指派、期限、查看來源

## 備註功能規格

### 資料結構
- **欄位名稱**：`Item.notes`（獨立欄位，非 meta）
- **資料類型**：字串（多行文字）
- **輔助欄位**：
  - `Item.notes_updated_at`：最後更新時間（ISO 8601）
  - `Item.notes_updated_by`：最後更新者 email

### 顯示規則
- 在任務卡片底部顯示備註預覽
- 預覽最多 2 行，超過顯示省略符號「...」
- 如果沒有備註，顯示淡色提示「點擊新增備註」
- 備註區域使用淡灰色背景區分

### 編輯方式
- 點擊備註區域直接進入編輯模式（inline editing）
- 編輯時顯示多行輸入框（textarea，最少 3 行）
- 提供「儲存」和「取消」按鈕
- 按 `Ctrl+Enter`（Windows）或 `Cmd+Enter`（Mac）快速儲存
- 按 `Esc` 取消編輯

### 權限控制
- 所有專案成員都可以編輯任何任務的備註
- 無需特殊權限檢查

### 編輯歷史
- 儲存時自動記錄：
  - 更新時間（`notes_updated_at`）
  - 更新者（`notes_updated_by`，使用當前登入者 email）
- 在備註下方顯示「最後更新：[時間] by [姓名]」
- 如果是本人更新，顯示「最後更新：[時間] (你)」

### UI 元件設計
- 使用 Tailwind CSS 設計系統變數
- 背景色：`bg-muted/50`
- 邊框：`border border-border`
- 圓角：`rounded-[var(--radius-md)]`
- 文字：使用 Noto Sans TC
- 編輯框高度：最少 3 行（`rows={3}`），自動擴展

### 驗證規則
- 備註無字數限制
- 允許空白內容（清空備註）
- 自動去除前後空白（trim）

### 資料持久化
- 使用 LocalAdapter 的 `updateItem` 方法
- 更新時一併更新 `updated_at` 欄位

## 驗收標準
- 入庫的項目一定能在某個視圖中被找到
- 一般成員開啟任務清單 → 預設在我的任務
- PM 開啟任務清單 → 預設在專案工作
- ✅ 所有任務卡片底部都有備註區域
- ✅ 點擊備註區域可立即編輯
- ✅ 備註儲存後立即顯示，並記錄編輯時間和編輯者

## 測試案例
- PM 指派一筆專案工作給工程師 → 工程師在我的任務看到新增任務
- 待回覆逾期 → 待回覆視圖可用「逾期」快速篩選
- ✅ TC-備註-01：成員點擊空白備註區域 → 顯示編輯框，輸入文字並儲存 → 備註顯示在卡片上
- ✅ TC-備註-02：成員編輯現有備註 → 修改內容並儲存 → 備註更新，顯示新的更新時間和更新者
- ✅ TC-備註-03：成員輸入超過 2 行的備註 → 卡片預覽顯示 2 行並加上「...」，點擊展開完整內容
- ✅ TC-備註-04：成員按 Esc 取消編輯 → 備註恢復原內容
- ✅ TC-備註-05：成員清空備註內容並儲存 → 備註區域顯示「點擊新增備註」提示