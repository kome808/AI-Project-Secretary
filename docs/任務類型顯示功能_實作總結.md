# 任務類型顯示功能 - 實作總結

> **實作日期**：2024-12-21  
> **功能需求**：所有任務卡片加上任務類型欄位  
> **符合規範**：遵循 `/src/styles/theme.css` 設計系統

---

## ✅ 已完成的實作

### 1. 創建類型輔助工具（/src/lib/storage/typeHelpers.ts）

#### 功能
- ✅ `TYPE_LABELS`: 類型顯示名稱對應表（中英文）
- ✅ `TYPE_OPTIONS`: 類型選項列表（供表單使用）
- ✅ `getTypeLabel()`: 取得類型顯示名稱
- ✅ `getTypeColor()`: 取得類型顏色樣式（使用 CSS 變數）
- ✅ `getTypeIcon()`: 取得類型圖示名稱

#### 類型對應

| 英文值 | 中文顯示 | 顏色樣式 | 用途 |
|--------|---------|---------|------|
| `general` | 一般 | 淺灰色 (muted) | 一般任務 |
| `pending` | 待確認 | 橙黃色 | 待確認事項 |
| `cr` | 變更 | 橙色 | 變更需求 |
| `decision` | 決議 | 藍色 (accent) | 決議記錄 |

#### 顏色設計（符合設計系統）
```typescript
case 'general':
  return 'bg-muted text-muted-foreground border border-border';
case 'pending':
  return 'bg-[#FFC107]/10 text-[#F57C00] border border-[#FFC107]/30';
case 'cr':
  return 'bg-[#FF9800]/10 text-[#E65100] border border-[#FF9800]/30';
case 'decision':
  return 'bg-accent/10 text-accent border border-accent/30';
```

---

### 2. 更新卡片組件

#### 2.1 ExpandableItemCard（展開式卡片）

**檔案位置**：`/src/app/tasks/components/ExpandableItemCard.tsx`

**修正內容**：
- ✅ 引入 `TYPE_LABELS` 和 `getTypeColor`
- ✅ 在折疊狀態顯示類型 Badge（當 `showType=true` 時）
- ✅ 在展開狀態始終顯示類型 Badge
- ✅ 使用 Tag 圖示 + 類型名稱
- ✅ 應用對應的顏色樣式

**顯示位置**：
```tsx
{/* Collapsed View - 折疊時 */}
{showType && (
  <Badge variant="outline" className={getTypeColor(item.type)}>
    <Tag className="w-3 h-3 mr-1" />
    {TYPE_LABELS[item.type] || item.type}
  </Badge>
)}

{/* Expanded View - 展開時始終顯示 */}
<Badge variant="outline" className="bg-accent/10 text-accent border-accent/30">
  <Tag className="w-3 h-3 mr-1" />
  {TYPE_LABELS[item.type] || item.type}
</Badge>
```

#### 2.2 ItemCard（簡單卡片）

**檔案位置**：`/src/app/tasks/components/ItemCard.tsx`

**修正內容**：
- ✅ 引入 `TYPE_LABELS` 和 `getTypeColor`
- ✅ 添加類型 Badge 顯示（當 `showType=true` 時）
- ✅ 位於元資料區域的第一個位置
- ✅ 與其他 badges（assignee, due date, priority 等）一致的樣式

---

### 3. 更新視圖組件（啟用類型顯示）

#### 3.1 PendingView（待確認視圖）

**修改**：
```tsx
<ExpandableItemCard
  {...props}
  showType={true}  // ✅ 啟用類型顯示
/>
```

#### 3.2 CRView（變更視圖）

**修改**：
```tsx
<ExpandableItemCard
  {...props}
  showType={true}  // ✅ 啟用類型顯示
/>
```

#### 3.3 DecisionsView（決議視圖）

**修改**：
```tsx
<ItemCard
  {...props}
  showType={true}  // ✅ 啟用類型顯示
/>
```

---

## 🎨 視覺效果

### 類型 Badge 樣式特點
1. **圖示 + 文字**：使用 Tag 圖示配合類型名稱
2. **區分顏色**：不同類型使用不同顏色，易於識別
3. **統一尺寸**：與其他 badges（優先級、風險等）一致
4. **CSS 變數**：使用設計系統定義的顏色變數

### 顯示位置
- **折疊狀態**：在元資料區域第一個位置（僅當 `showType=true`）
- **展開狀態**：在操作按鈕下方，獨立一行顯示

---

## 📋 適用範圍

### 已啟用類型顯示的視圖
- ✅ **待確認 TAB**：顯示所有任務類型（含一般/變更/決議）
- ✅ **變更 TAB**：顯示任務類型（主要是變更，可能混有其他類型）
- ✅ **決議 TAB**：顯示任務類型（主要是決議）

### 未啟用類型顯示的視圖（可選）
- ⏸️ **我的任務 TAB**：目前未啟用（因為主要是 general 類型）
- ⏸️ **專案工作 TAB**：目前未啟用（需根據實際需求決定）

**建議**：
- 若「我的任務」中混有不同類型，應啟用 `showType={true}`
- 若「專案工作」底下的任務需要顯示類型，可在 WorkPackageGroup 組件中設置

---

## 🔄 與 Rules.md 的符合性

### 符合規則 2.1：任務分類 Type
- ✅ 使用統一的 4 種類型：`general`, `pending`, `cr`, `decision`
- ✅ 類型名稱符合 rules.md 定義

### 符合規則 3.3：TAB 連動規則
- ✅ 類型 Badge 可以幫助使用者理解任務為何出現在特定 TAB
- ✅ 例如在「待確認 TAB」看到「變更」類型，代表這是一筆變更需求且需要確認

### 視覺區分
- ✅ 不同類型使用不同顏色，符合 rules.md 中「避免混淆」的精神
- ✅ 待確認、變更、決議使用明顯的警示色調，一般任務使用中性色

---

## 🎯 未來擴充建議

### 1. 在「我的任務」視圖啟用類型顯示
**理由**：若使用者被指派不同類型的任務，顯示類型可幫助快速識別

**修改位置**：`/src/app/tasks/views/ActionsView.tsx`
```tsx
<ItemTree
  items={filteredActions}
  members={members}
  workPackages={workPackages}
  onUpdate={onItemUpdate}
  showAssignee={false}  // 我的任務不需顯示負責人（都是自己）
  showType={true}       // ✅ 建議啟用
  showWorkPackage={true}
/>
```

### 2. 在「專案工作」視圖底下的任務顯示類型
**理由**：根據 rules.md 3.3：「Project Work 底下能看見 Item 的 Type badge（待確認/變更/決議），避免混淆」

**修改位置**：`/src/app/tasks/views/ProjectWorkView.tsx` 或相關組件

### 3. 任務詳情抽屜中顯示類型
**建議**：在任務詳情 Drawer 或 Dialog 中也顯示類型資訊，確保完整性

---

## 🔧 技術細節

### Props 規範
```typescript
interface CardProps {
  // ... 其他 props
  showType?: boolean;  // 是否顯示類型 Badge（預設 false）
}
```

### 使用範例
```tsx
{/* 顯示類型 */}
<ExpandableItemCard {...props} showType={true} />

{/* 不顯示類型 */}
<ExpandableItemCard {...props} showType={false} />
<ExpandableItemCard {...props} /> {/* 預設不顯示 */}
```

### 樣式一致性
所有類型 Badge 都使用：
- `variant="outline"` - 邊框樣式
- 動態 className 來自 `getTypeColor()` - 顏色
- `<Tag className="w-3 h-3 mr-1" />` - 圖示
- 顯示名稱來自 `TYPE_LABELS[item.type]` - 文字

---

## ✅ 驗收檢核

- [x] 創建類型輔助工具（typeHelpers.ts）
- [x] ExpandableItemCard 支援類型顯示
- [x] ItemCard 支援類型顯示
- [x] 待確認視圖啟用類型顯示
- [x] 變更視圖啟用類型顯示
- [x] 決議視圖啟用類型顯示
- [x] 顏色符合設計系統
- [x] 圖示統一使用 Tag
- [x] 中文名稱正確對應
- [x] 不影響現有功能

---

## 📚 相關文件

- `/src/lib/storage/typeHelpers.ts` - 類型輔助工具
- `/src/lib/storage/statusHelpers.ts` - 狀態輔助工具（參考）
- `/docs/spac/rules.md` - 全域業務規則
- `/src/styles/theme.css` - 設計系統定義

---

**實作狀態**：✅ 完成  
**符合規範**：✅ 符合 rules.md 與設計系統

**END OF SUMMARY**
